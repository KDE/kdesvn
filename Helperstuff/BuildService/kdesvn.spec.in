# norootforbuild
Summary:   A subversion client for the KDE with KIO integration.
Name:      kdesvn
Version:   @VERSION@
Release:   1
License:   LGPL
Vendor:    Rajko Albrecht <ral@alwins-world.de>
Url:       http://kdesvn.alwins-world.de
Packager:  Rajko Albrecht <ral@alwins-world.de>
Group:     Development/Tools
Source:    kdesvn-%version.tar.bz2
BuildRoot: %{_tmppath}/%{name}-root
Obsoletes: kdesvn-kioksvn kdesvn-svnqt
Requires: subversion >= 1.2.0
Requires: /usr/bin/dot
BuildRequires: cmake >= 2.4
BuildRequires: gcc-c++
BuildRequires: subversion-devel
Patch1: build_fix.patch
Patch2: diff_data_fix.patch

%if 0%{?fedora_version} > 0 || 0%{?rhel_version} > 0 || 0%{?centos_version} > 0
BuildRequires: apr-devel
BuildRequires: apr-util-devel
%if 0%{?fedora_version} > 8
BuildRequires: kdelibs3-devel
%else
BuildRequires: kdelibs-devel >= 3.4
%endif
%define _prefix /usr
%endif

%if 0%{?suse_version} > 0
BuildRequires: xorg-x11-devel
BuildRequires: kdelibs3-devel
%define _prefix /opt/kde3
%if %suse_version >= 1010
BuildRequires:  libapr1 libapr1-devel libapr-util1 libapr-util1-devel
%else
BuildRequires:  libapr0
%endif
%define _bindir %{_prefix}/bin
%define _datadir %{_prefix}/share
%define _libdir %{_prefix}/%_lib
%define _includedir %{_prefix}/include
%endif


%description
Kdesvn is a subversion client for KDE.
It may used as standalone application or plugin (KPart). Base functions are provided
via a KIO protocoll, too.

%package kiosvn
Requires: kdesvn = %{version}
Group:    Development/Tools
Summary:  A kde-kio integration for subversion based on kdesvn

%description kiosvn
KIO integration (KIO::svn) based on kdesvn alternative protocol name.

%package devel
Group:    Development/Libraries
Summary:  Wrapper lib for subversion QT integration.
Requires: subversion-devel >= 1.2.0
Requires: kdesvn = %{version}
Obsoletes: kdesvn-svnqt-devel

%description devel
Development files for kdesvn.

%prep
%setup
%patch1 -p1
%patch2 -p1
mkdir build
cd build
cmake ../ -DCMAKE_INSTALL_PREFIX=`kde-config --prefix` -DCMAKE_BUILD_TYPE=Release -DLIB_SUFFIX=`kde-config --libsuffix`

%build
%if 0%{?suse_version} > 0
. /etc/opt/kde3/common_options
%endif
cd build
make %{?jobs:-j%jobs}

%install
cd build
make install DESTDIR=$RPM_BUILD_ROOT

%clean
rm -rf $RPM_BUILD_ROOT/*
rm -rf $RPM_BUILD_DIR/kdesvn


%files
%{_bindir}/kdesvn
%{_bindir}/kdesvnaskpass
%{_libdir}/*/*part*
%{_datadir}/applications/*
%{_datadir}/apps/kdesvn/*
%{_datadir}/apps/kdesvnpart/*
%{_datadir}/apps/kconf_update/*
%{_datadir}/config.kcfg/*
%{_datadir}/doc/*
%{_datadir}/icons/*
%{_datadir}/locale/*
%{_libdir}/*/kded_kdesvnd.*
%{_datadir}/services/kded/kdesvnd.desktop
%{_datadir}/apps/konqueror/servicemenus/kdesvn*
%{_libdir}/*/kio_ksvn*
%{_datadir}/services/ksvn*.protocol
%{_datadir}/man/man1/*
%{_libdir}/libsvnqt*.so*

%files kiosvn
%{_datadir}/services/svn*.protocol

%files devel
%dir %{_includedir}/svnqt
%{_includedir}/svnqt/*

